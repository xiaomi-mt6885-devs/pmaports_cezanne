# Contributor: jacopo mondi <jacopo@jmondi.org>
# Maintainer: jacopo mondi <jacopo@jmondi.org>
pkgname=libcamera
pkgver=0.0.2
pkgrel=0
pkgdesc="A complex camera support library for Linux, Android and ChromeOS"
url="www.libcamera.org"
arch="all"
license="LGPL-2.1"
depends="eudev-dev libevent-dev sdl2 sdl2_image gnutls"
makedepends="meson py3-yaml py3-jinja2 py3-ply gnutls-dev cmake linux-headers yaml-dev sdl2-dev sdl2_image-dev"
checkdepends=""
source="
	libcamera-v$pkgver.tar.gz::https://gitlab.com/jmondi/libcamera/-/archive/v0.0.2/libcamera-v0.0.2.tar.gz"
builddir="$srcdir/$pkgname-v$pkgver"

# Don't strip: IPA modules are signed, and signature is generated on the
# un-stripped binary. If we strip when installing the signature validation
# will fail resulting in the IPA module running isolated
options="!strip"

build() {
	abuild-meson \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var \
		--buildtype=plain \
		-D pipelines=simple,rkisp1 \
		-D test=false \
		-D lc-compliance=disabled\
		output

	meson compile ${JOBS:+-j ${JOBS}} -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output
}

sha512sums="
95ff8338ae82ff5b52832a9ebd877b3e44268c6ede5c5d8f876ffdc9f2477118a86886b36dd347263be5ec38fc95d7eeac24b2e7964afdbb54da011421c878bd  libcamera-v0.0.2.tar.gz
"
