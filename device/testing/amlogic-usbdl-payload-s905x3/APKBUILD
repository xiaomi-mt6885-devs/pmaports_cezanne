# Maintainer: Petr Hodina <phodina@protonmail.com>
pkgname=amlogic-usbdl-payload-s905x3
pkgver=0_git20222708
_commit="55779d6e8f9fe82cdcff7a0f825e61ad4fe2689e"
pkgrel=0
pkgdesc="Dump Bootrom BL1"
url="https://github.com/Raxone/amlogic-usbdl_s905x3"
arch="aarch64"
license="GPL-3.0-or-later"
source="$pkgname-$_commit.tar.gz::https://github.com/Raxone/amlogic-usbdl_s905x3/archive/$_commit.tar.gz"
builddir="$srcdir/amlogic-usbdl_s905x3-$_commit/payloads/src"
options="!check" # No tests

build() {
	export CROSS_COMPILER=""
	make
}

package() {
	install -Dm644 dump_bootrom_uart.bin "$pkgdir"/usr/share/"$pkgname"
	install -Dm644 fix_usb.bin "$pkgdir"/usr/share/"$pkgname"
	install -Dm644 memdump_over_usb_all.bin "$pkgdir"/usr/share/"$pkgname"
	install -Dm644 memdump_over_usb_bl1.bin "$pkgdir"/usr/share/"$pkgname"
	install -Dm644 memdump_over_usb_efuse.bin "$pkgdir"/usr/share/"$pkgname"
	install -Dm644 run_fastboot.bin "$pkgdir"/usr/share/"$pkgname"
	install -Dm644 sleep_n_reset.bin "$pkgdir"/usr/share/"$pkgname"
}

sha512sums="937aa42b4d074d47b80a6a2a31bbcd688f6f23f7dbfe51d0f5a89d3b0618cce831347e8fdc8079b35114ad5884d4320d959349f7811a08fc67fcd78b128d41a3  amlogic-usbdl-payload-s905x3-55779d6e8f9fe82cdcff7a0f825e61ad4fe2689e.tar.gz"
